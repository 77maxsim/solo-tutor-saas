Fix Dashboard Earnings + Upcoming Sessions for Oliver (No Hardcoding)
We're still facing two unresolved issues for Oliver:

ðŸ§¾ Issue 1: Incorrect "Earned This Month" Calculation in Dashboard
Oliverâ€™s â€œEarned This Monthâ€ card shows only Â¥80.00, but logs confirm many paid sessions during June (e.g., June 14th).

The paid field is correctly marked as true, and data appears correctly on the Earnings Page.

Logs show the following incorrect entry in dashboardStats:

ts
ÐšÐ¾Ð¿Ñ–ÑŽÐ²Ð°Ñ‚Ð¸
Ð ÐµÐ´Ð°Ð³ÑƒÐ²Ð°Ñ‚Ð¸
"currentMonthEarnings": 80
Timezone is set to Asia/Shanghai, and some sessions show correct displayed_time in local time:

ts
ÐšÐ¾Ð¿Ñ–ÑŽÐ²Ð°Ñ‚Ð¸
Ð ÐµÐ´Ð°Ð³ÑƒÐ²Ð°Ñ‚Ð¸
utc_start: "2025-06-23T05:00:00+00:00" -> displayed_time: "06/23/2025 at 13:00"
What to do:

Double-check the Dashboardâ€™s earnings calculation logic against the working Earnings Page. Both should use session_start in UTC, converted to the tutor's timezone (via .tz(tutor.timezone)).

Avoid logic like:

ts
ÐšÐ¾Ð¿Ñ–ÑŽÐ²Ð°Ñ‚Ð¸
Ð ÐµÐ´Ð°Ð³ÑƒÐ²Ð°Ñ‚Ð¸
dayjs.utc(session.session_start).tz(tz).isSame(dayjs(), 'month')
Instead:

ts
ÐšÐ¾Ð¿Ñ–ÑŽÐ²Ð°Ñ‚Ð¸
Ð ÐµÐ´Ð°Ð³ÑƒÐ²Ð°Ñ‚Ð¸
const sessionDate = dayjs.utc(session.session_start).tz(tz);
const now = dayjs().tz(tz);
const isSameMonth = sessionDate.month() === now.month() && sessionDate.year() === now.year();
This prevents issues from hidden UTC-local mismatches.

Validate that you're filtering sessions with paid = true and tutor_id = current tutor only.

Do not hardcode Oliver's timezone or email â€” respect each tutorâ€™s timezone field.

Do not reference deprecated date or time columns â€” use only session_start.

ðŸ§¾ Issue 2: Upcoming Sessions Page Crashes (Empty Page + Error)
When Oliver clicks â€œUpcoming Sessionsâ€, the component crashes with:

txt
ÐšÐ¾Ð¿Ñ–ÑŽÐ²Ð°Ñ‚Ð¸
Ð ÐµÐ´Ð°Ð³ÑƒÐ²Ð°Ñ‚Ð¸
Error loading upcoming sessions
This might be due to:

A failed query due to broken filter logic (e.g., bad timezone math or invalid RLS access).

Sessions being incorrectly excluded due to date range filtering.

Incorrect serialization/deserialization of session_start.

What to do:

Log the query that fetches Upcoming Sessions and confirm:

You are using session_start > now() in UTC, or adjusted to the tutor's timezone.

The sessions belong to the correct tutor_id.

Avoid applying .tz() on dayjs() without checking if the date is valid.

Do not assume that session_start is already localized â€” always handle the UTC â†’ local conversion safely.

Add debug logging to show how many sessions are found and what the query filters look like in the frontend and backend.

If the session list is empty, the page should render gracefully with a message (not crash).

âœ… Constraints
âœ… Do not use deprecated date or time columns â€” only use session_start.

âœ… Do not hardcode any tutor (e.g., Oliverâ€™s email or timezone).

âœ… Use the existing shared earningsCalculator function across both Earnings and Dashboard.

âœ… Must support multi-timezone logic via the tutor.timezone field.

âœ… Must respect Supabase RLS â€” only fetch sessions where tutor_id = current_user.

ðŸ“¸ Context from logs
Oliverâ€™s timezone: Asia/Shanghai

session_start examples (in UTC) display correctly as local time (e.g., 13:00 CST from 05:00 UTC).

However, the currentMonthEarnings = 80 indicates only 1 session is being counted incorrectly.

Activity and Supabase clearly show dozens of June payments marked as paid: true.